<!DOCTYPE html>
<html>
    <head>
        <base href="/">
        <title>YouTube Player v2.0</title>
        <link rel="icon" href="favicon.ico">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="assets/css/normalize.css">
        <link rel="stylesheet" href="assets/css/main.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />        
    </head>
    <body class="application app-win">
        <div class="updates" style="position: fixed; top: 0; z-index: 999; background-color: red; color: white">
            <div id="output"></div>
        </div>
        <app-yt>
            <div class="loading-app">
                <i class="fa fa-circle-o-notch fa-spin fa-2x fa-fw"></i>
                <span class="sr-only">Loading...</span>
            </div>
        </app-yt>
        <script>
            const AutoUpdater = require( "nw-autoupdater" ),
                updater = new AutoUpdater( require( "./package.json" ) ),
                output =  document.querySelector( "#output" );
                
            async function main(){
                try {
                // Update copy is running to replace app with the update
                if ( updater.isSwapRequest() ) {
                    output.innerHTML += `\nSwapping...`;
                    await updater.swap();
                    output.innerHTML += `\nDone...`;
                    await updater.restart();
                    return;
                }
                // Download/unpack update if any available
                const rManifest = await updater.readRemoteManifest();
                const needsUpdate = await updater.checkNewVersion( rManifest );
                if ( !needsUpdate ) {
                    output.innerHTML += `\nIs up to date...`;
                    return;
                }
                if ( !confirm( "New release is available. Do you want to upgrade?" ) ) {
                    return;
                }
                // Subscribe for progress events
                updater.on( "download", ( downloadSize, totalSize ) => {
                    output.innerHTML = `Downloading...`;
                    console.log( "download progress", Math.floor( downloadSize / totalSize * 100 ), "%" );
                });
                updater.on( "install", ( installFiles, totalFiles ) => {
                    output.innerHTML = `Installing...\n`;
                    console.log( "install progress", Math.floor( installFiles / totalFiles * 100 ), "%" );
                });
                const updateFile = await updater.download( rManifest );
                await updater.unpack( updateFile );
                alert( `The application will automatically restart to finish installing the update` );
                await updater.restartToSwap();
                } catch ( e ) {
                console.error( e );
                }
            }
            output.innerHTML = `Application v${nw.App.manifest.version}\n`;
            main();

        </script>
    <script type="text/javascript" src="inline.bundle.js"></script><script type="text/javascript" src="polyfills.bundle.js"></script><script type="text/javascript" src="styles.bundle.js"></script><script type="text/javascript" src="vendor.bundle.js"></script><script type="text/javascript" src="main.bundle.js"></script></body>
</html>
